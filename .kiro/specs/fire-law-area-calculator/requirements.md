# Requirements Document

## Project Description (Input)
消防法の複合用途防火対象物で構成用途とその部分面積、共用部の面積を入力し、共用部の面積を案分し構成用途の面積を算出するWEBアプリを作成する

## Introduction
本アプリケーションは、消防法に基づく複合用途防火対象物の面積計算を支援するWebアプリケーションです。建物の階ごとに複数の構成用途（消防法施行令別表第一に基づく項番号）とその専用部分面積を入力し、さらに3種類の共用部面積（階の共用部、建物全体の共用部、グループ共用部）を入力することで、共用部面積を各用途に案分し、各用途の総面積を算出します。建物全体の共用部は各階に存在する可能性があり、各階ごとに入力された建物全体の共用部面積の合計を全階・全用途に案分します。グループ共用部も各階に存在する可能性があり、各階ごとに、建物全体の任意の2用途以上（ただし全用途未満）を選択して入力します。グループ共用部を共有する用途は、その階に存在しない用途も含めて自由に組み合わせることができます。案分は建物全体の専用部分面積の比率で行われます。階ごとの計算結果に加えて建物全体の集計も行い、消防設備の設置基準判定や防火対象物の分類に必要な正確な面積計算を効率的に行うことができます。

## Requirements

### Requirement 1: 階の管理
**Objective:** ユーザーとして、建物の各階を個別に管理したい。これにより、階ごとに異なる用途構成と面積を正確に記録できる。

#### Acceptance Criteria
1. When ユーザーが階追加操作を実行する, the システム shall 新しい階の入力セクションを作成する
2. The システム shall 各階について階名称（階数）を入力・編集できる機能を提供する
3. When ユーザーが階を削除する, the システム shall 該当する階とその配下の全用途データおよび階の共用部データを削除する
4. The システム shall 最低1つ以上の階が存在する状態を維持する
5. The システム shall 階を追加順または階数順に表示する機能を提供する
6. When ユーザーが階情報を編集する, the システム shall 変更を即座に反映する

### Requirement 2: 階ごとの構成用途の入力管理
**Objective:** ユーザーとして、各階に含まれる構成用途（消防法施行令別表第一に基づく項番号）の情報を入力・管理したい。これにより、階ごとの面積案分計算の基礎データを正確に登録できる。

#### Acceptance Criteria
1. When ユーザーが特定の階に用途追加操作を実行する, the システム shall その階に新しい用途入力フォームを表示する
2. The システム shall 各階の各用途について用途コード（別表第一の項番号：１項イ、１項ロ、２項イ、２項ロ、２項ハ、２項ニ、３項イ、３項ロ、４項、５項イ、５項ロ、６項イ(1)～(4)、６項ロ(1)～(5)、６項ハ(1)～(5)、６項ニ、７項～２０項）を選択し、専用部分面積を入力できる機能を提供する
3. The システム shall 用途コード選択にドロップダウンリストまたは同等のUIコンポーネントを使用する
4. When ユーザーが用途を削除する, the システム shall 該当する用途データおよび紐づく特定用途間の共用部データを削除し画面を更新する
5. The システム shall 各階に最低1つ以上の用途が入力されている状態を維持する
6. When ユーザーが用途情報を編集する, the システム shall 入力内容をリアルタイムで保持する
7. The システム shall 階ごとに独立した用途リストを管理する
8. The システム shall 用途コードを `annexedCode` として内部管理し、用途名称を `annexedName` として表示に使用する
9. The システム shall 各用途を一意に識別するための用途ID（`usageId`）を生成・管理する
10. The システム shall 異なる階に同一の用途コードを持つ複数の用途が存在することを許可する

### Requirement 3: 階の共用部面積の入力
**Objective:** ユーザーとして、各階の共用部面積を入力したい。これにより、その階の全用途に対して共用部面積を案分計算できる。

#### Acceptance Criteria
1. The システム shall 各階に「階の共用部」面積を入力するための数値入力フィールドを提供する
2. When ユーザーが階の共用部面積を入力する, the システム shall 入力値をその階に紐づけて保持する
3. If 階の共用部面積が0または空白である, the システム shall その階における階の共用部の案分計算をスキップする
4. The システム shall 階の共用部面積として正の数値のみを受け付ける
5. The システム shall 階ごとに独立した階の共用部面積を管理する

### Requirement 4: 建物全体の共用部面積の入力
**Objective:** ユーザーとして、建物全体の共用部面積を各階ごとに入力したい。これにより、各階に存在する建物全体の共用部を適切に記録し、全階・全用途に対して建物全体の共用部面積を案分計算できる。

#### Acceptance Criteria
1. The システム shall 各階に建物全体の共用部面積を入力するための数値入力フィールドを提供する
2. When ユーザーが各階の建物全体の共用部面積を入力する, the システム shall 入力値をその階に紐づけて保持する
3. If ある階の建物全体の共用部面積が0または空白である, the システム shall その階における建物全体の共用部面積を0として扱う
4. The システム shall 建物全体の共用部面積として正の数値のみを受け付ける
5. The システム shall 各階ごとに独立した建物全体の共用部面積を管理する
6. The システム shall 全階の建物全体の共用部面積の合計を算出し、全階・全用途の案分計算に使用する

### Requirement 5: 特定用途間の共用部面積の入力（グループ共用）
**Objective:** ユーザーとして、各階において、建物全体の任意の複数用途間で共有される共用部面積（グループ共用）を入力したい。これにより、その階に存在しない用途も含む特定の用途グループのみに共用部面積を案分できる。

#### Acceptance Criteria
1. When 建物全体に2以上の用途が存在する, the システム shall 各階において、任意の複数用途（2用途以上、建物全用途未満）の組み合わせに対して「グループ共用部」面積を入力するための機能を提供する
2. The システム shall ユーザーが共用部を共有する複数の用途（2用途以上）を全階の全用途から選択できる機能を提供する
3. The システム shall その階に存在しない用途も含めて自由に選択できる機能を提供する
4. When ユーザーが用途グループを選択する, the システム shall 建物全体の全用途を選択することを禁止する（全用途の場合は建物全体の共用部を使用）
5. When ユーザーが特定用途間の共用部面積を入力する, the システム shall 入力値を選択された用途グループおよびその階に紐づけて保持する
6. If 特定用途間の共用部面積が0または空白である, the システム shall その用途グループの共用部を加算しない
7. The システム shall 特定用途間の共用部面積として正の数値のみを受け付ける
8. The システム shall 各階において複数の用途グループに対して独立した共用部面積を管理する
9. When 用途グループに含まれる用途が削除される, the システム shall 該当する共用部データも削除する
10. The システム shall 各用途グループについて選択された用途の組み合わせを明示的に表示する（階名、用途コード、用途名称を含む）
11. The システム shall 同一階内の用途のみを選択した場合も有効な用途グループとして扱う
12. The システム shall 異なる階に同一用途グループ構成のグループ共用部が存在することを許可する（各階独立）
13. The システム shall 全階のグループ共用部データを階ごとに管理し、階とともに表示する

### Requirement 6: 入力値の検証
**Objective:** ユーザーとして、入力した数値データが正しい形式であることを確認したい。これにより、計算エラーを未然に防ぐことができる。

#### Acceptance Criteria
1. When ユーザーが面積に数値以外を入力する, the システム shall エラーメッセージを表示する
2. If 面積に負の数値が入力される, then the システム shall エラーメッセージを表示し計算を実行しない
3. When 用途コードが選択されていない状態で送信される, the システム shall 警告メッセージを表示する
4. When 階名称が空白で送信される, the システム shall 警告メッセージを表示する
5. The システム shall 面積の数値入力において小数点以下の桁数を許容する
6. If 必須項目が未入力である, the システム shall 計算実行ボタンを無効化する
7. When ユーザーが階番号に数値以外を入力する, the システム shall 警告メッセージを表示する

### Requirement 7: 階の共用部面積の案分計算
**Objective:** ユーザーとして、階の共用部面積をその階の各用途の専用部分面積の比率に応じて案分したい。これにより、階内の各用途に公平に共用部面積を配分できる。

#### Acceptance Criteria
1. When ユーザーが計算実行を指示する and 階の共用部面積が入力されている, the システム shall 各階について階内の各用途の専用部分面積の合計を算出する
2. When 階内の専用部分面積の合計が算出される, the システム shall 各用途の専用部分面積がその階全体に占める割合を計算する
3. When 各用途の割合が算出される, the システム shall その階の共用部面積を割合に応じて各用途に配分する
4. If 階内の専用部分面積の合計が0である and 階の共用部面積が入力されている, then the システム shall エラーメッセージを表示しその階の案分計算を中止する
5. The システム shall 案分された階の共用部面積を小数点以下2桁まで計算する
6. The システム shall 各階について独立して案分計算を実行する

### Requirement 8: 建物全体の共用部面積の案分計算
**Objective:** ユーザーとして、各階に入力された建物全体の共用部面積の合計を、全階・全用途の専用部分面積の比率に応じて案分したい。これにより、各階に存在する建物全体の共用部を全用途に公平に配分できる。

#### Acceptance Criteria
1. When ユーザーが計算実行を指示する, the システム shall 全階の建物全体の共用部面積の合計を算出する
2. When 建物全体の共用部面積の合計が算出される and 合計が0より大きい, the システム shall 全階・全用途の専用部分面積の総合計を算出する
3. When 専用部分面積の総合計が算出される, the システム shall 各用途の専用部分面積が建物全体に占める割合を計算する
4. When 各用途の割合が算出される, the システム shall 建物全体の共用部面積の合計を割合に応じて各用途に配分する
5. If 全用途の専用部分面積の総合計が0である and 建物全体の共用部面積の合計が0より大きい, then the システム shall エラーメッセージを表示し計算を中止する
6. If 全階の建物全体の共用部面積の合計が0である, the システム shall 建物全体の共用部の案分計算をスキップする
7. The システム shall 案分された建物全体の共用部面積を小数点以下2桁まで計算する
8. The システム shall 各階に入力された建物全体の共用部面積を集計してから案分計算を実行する

### Requirement 9: 特定用途間の共用部面積の案分計算（グループ共用の案分）
**Objective:** ユーザーとして、各階に入力された特定の用途グループ間の共用部面積を、そのグループ内の各用途の専用部分面積の比率（建物全体の面積比）に応じて案分したい。これにより、その階に存在しない用途も含む特定の用途グループのみに共用部を公平に配分できる。

#### Acceptance Criteria
1. When ユーザーが計算実行を指示する and 各階に特定用途間の共用部面積が入力されている, the システム shall 該当する用途グループ内の各用途の専用部分面積の合計を算出する
2. When 用途グループ内の専用部分面積の合計が算出される, the システム shall 各用途の専用部分面積がグループ内の合計に占める割合を計算する
3. When 各用途の割合が算出される, the システム shall 特定用途間の共用部面積を割合に応じてグループ内の各用途に配分する
4. If 用途グループ内の専用部分面積の合計が0である and 特定用途間の共用部面積が入力されている, then the システム shall エラーメッセージを表示しその共用部の案分計算を中止する
5. The システム shall 案分された特定用途間の共用部面積を小数点以下2桁まで計算する
6. The システム shall 各階の各用途グループについて独立して案分計算を実行する
7. When 同一の用途が複数の用途グループに含まれる, the システム shall それぞれのグループから案分された面積を当該用途に加算する
8. The システム shall 異なる階に属する用途も含めて建物全体の専用部分面積の比率で案分を行う
9. When 用途グループにその階に存在しない用途が含まれる, the システム shall その用途に対しても専用部分面積の比率に応じて案分を実行する
10. The システム shall 各階のグループ共用部を階ごとに独立して案分計算する
11. When 同一用途グループ構成のグループ共用部が複数階に存在する, the システム shall 各階のグループ共用部面積を独立して案分する

### Requirement 10: 総面積の算出
**Objective:** ユーザーとして、各用途の総面積を確認したい。これにより、専用部分面積と3種類の共用部面積を合算した正確な用途別総面積を把握できる。

#### Acceptance Criteria
1. When 全ての案分計算が完了する, the システム shall 各用途の総面積を以下の合計として算出する：専用部分面積 + 案分階の共用部 + 案分建物全体の共用部 + 案分特定用途間の共用部
2. The システム shall 各用途について、用途コード、用途名称、専用部分面積、案分階の共用部、案分建物全体の共用部、案分特定用途間の共用部（該当する組み合わせ全ての合計）、総面積の内訳を表示する
3. The システム shall 面積の数値を小数点以下2桁まで表示する
4. The システム shall 階ごとの各用途の総面積を表形式で表示する
5. When 計算結果が表示される, the システム shall 各階の全用途の総面積合計も表示する
6. The システム shall 計算結果を階ごと・用途ごとに整理された見やすい形式で表示する

### Requirement 11: 建物全体の集計
**Objective:** ユーザーとして、全階の計算結果を用途別に集計した建物全体の面積を確認したい。これにより、消防法に基づく判定に必要な建物全体の用途別総面積を把握できる。

#### Acceptance Criteria
1. When 全階の計算が完了する, the システム shall 同一用途コード（annexedCode）の面積を全階にわたって合計する
2. The システム shall 建物全体の集計結果を用途別に表示する
3. When 建物全体の集計を表示する, the システム shall 各用途について用途コード、用途名称、専用部分面積合計、案分階の共用部合計、案分建物全体の共用部合計、案分特定用途間の共用部合計、総面積合計を表示する
4. The システム shall 建物全体の総面積（全用途の総面積の合計）を表示する
5. The システム shall 階ごとの詳細と建物全体の集計を区別して表示する
6. The システム shall 用途コード順（別表第一の項番号順）で集計結果を表示する

### Requirement 12: 計算結果のクリアと再計算
**Objective:** ユーザーとして、入力データをクリアして新しい計算を開始したい。これにより、複数の防火対象物について繰り返し計算できる。

#### Acceptance Criteria
1. When ユーザーがクリア操作を実行する, the システム shall すべての階の入力データ、全ての共用部データ（階の共用部、建物全体の共用部、特定用途間の共用部）、計算結果を初期状態に戻す
2. The システム shall クリア操作後も最低1つの階と1つの用途入力フォームを維持する
3. When 入力値が変更される, the システム shall 既存の計算結果をクリアまたは再計算する
4. When ユーザーが再計算を実行する, the システム shall 最新の入力値で全ての案分計算と建物全体の集計を再実行する
5. The システム shall 特定の階のみをクリアする機能を提供する

### Requirement 13: ユーザーインターフェース
**Objective:** ユーザーとして、直感的で使いやすいインターフェースで操作したい。これにより、専門知識のないユーザーでも容易に利用できる。

#### Acceptance Criteria
1. The システム shall Webブラウザ上で動作するユーザーインターフェースを提供する
2. The システム shall レスポンシブデザインを採用しモバイル端末でも利用可能にする
3. When ユーザーが操作を実行する, the システム shall 即座にフィードバックを提供する
4. The システム shall 入力フィールドとボタンに明確なラベルを表示する
5. The システム shall 計算結果を視覚的に理解しやすい形式で表示する
7. The システム shall 階の追加・削除操作を直感的に実行できるUIを提供する
8. The システム shall 階ごとのデータ入力セクションを視覚的に区別して表示する
9. The システム shall 各階に3種類の共用部面積入力フィールド（階の共用部、建物全体の共用部、グループ共用部）を明確に区別して表示する
10. The システム shall 各共用部の種類（階の共用、建物全体の共用、グループ共用）について説明やヒントを提供する
11. When 建物全体に2以上の用途が存在する, the システム shall 各階においてグループ共用部を入力するための複数用途選択UIを提供する
12. The システム shall 選択された用途グループを視覚的に明示する（階名、用途コード、用途名称を表示）
13. When 用途グループ選択時に全用途が選択される, the システム shall 警告メッセージを表示し選択を無効にする
14. The システム shall 各用途グループに対して選択用途数（2以上、全用途未満）を表示する
15. The システム shall 用途コード選択UIにおいて、用途コードと用途名称の両方を表示する
16. The システム shall グループ共用部の用途選択UIで全階の全用途を一覧表示し、階ごとにグループ化して表示する
17. The システム shall その階に存在しない用途も選択可能であることを視覚的に示す
18. The システム shall 各階の建物全体の共用部入力フィールドを階の共用部入力フィールドと視覚的に区別して表示する
19. The システム shall 各階のグループ共用部を階ごとに表示し、階とグループの関係を明示する
